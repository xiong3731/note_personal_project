# 分布式存储

## **一、分布式存储的定义**

分布式存储是指 **将数据分散存储在多台节点上，通过网络协调管理，实现高可用、可扩展和容错的数据存储系统**。

特点：

- 数据冗余（保证可靠性）
- 可扩展（水平扩展节点）
- 高可用（单节点故障不影响整体）
- 支持大容量、高并发访问

------

## **二、分布式存储的分类**

按访问接口和存储方式，常见分类：

| 类型              | 接口/访问方式               | 特点                           | 典型产品                      |
| ----------------- | --------------------------- | ------------------------------ | ----------------------------- |
| 块存储 (Block)    | 类似硬盘，按块读写          | 高性能，适合数据库和虚拟机磁盘 | Ceph RBD、Amazon EBS          |
| 文件存储 (File)   | POSIX 文件系统接口          | 提供共享目录和文件访问，易集成 | HDFS、CephFS、GlusterFS       |
| 对象存储 (Object) | HTTP/REST 接口（S3 API 等） | 高容量、易扩展，支持元数据丰富 | Ceph Object、MinIO、Amazon S3 |

------

## **三、分布式存储的核心技术**

### 1️⃣ 数据管理

- **数据分片（Sharding）**：将大数据拆分到多个节点，提高并发
- **副本机制**：
  - **复制（Replication）**：简单粗暴，高可用、读性能好
  - **纠删码（Erasure Coding）**：存储效率高，写入复杂，适合大容量对象存储
- **元数据管理**：
  - **集中式**（如 HDFS NameNode）
  - **去中心化**（如 Ceph MDS）

### 2️⃣ 一致性算法

- **Paxos**：经典分布式一致性算法
- **Raft**：更易理解，实现 leader/follower 机制保证强一致性

### 3️⃣ 容错与可用性

- 节点故障自动恢复
- 自动数据重平衡
- 支持多副本或纠删码容忍多个节点宕机

### 4️⃣ 性能优化

- 缓存机制（读缓存、写缓存）
- 数据局部性（数据尽量靠近计算节点）
- 网络优化（RDMA、分布式协议优化）

------

## **四、分布式存储的架构层次**

1. **数据层（Data Layer）**
   - 存储实际数据块或对象
   - 提供冗余、分片、纠删码功能
2. **元数据层（Metadata Layer）**
   - 管理数据位置、权限、目录结构
   - 典型：HDFS NameNode、Ceph MDS
3. **访问层（Access Layer）**
   - 提供客户端接口
   - 支持多种协议：POSIX、S3 API、块存储接口
4. **管理层（Management Layer）**
   - 监控、运维、扩容、告警
   - 包括负载均衡和数据迁移策略



## **五、典型分布式存储产品**

| 产品/系统          | 类型              | 特点                                    |
| ------------------ | ----------------- | --------------------------------------- |
| HDFS               | 文件存储          | Hadoop 生态核心，适合大数据批处理       |
| Ceph               | 块/文件/对象      | 高可扩展、高可靠，支持 RBD、CephFS、RGW |
| MinIO              | 对象存储          | S3 兼容，高性能，适合云原生和容器场景   |
| GlusterFS          | 文件存储          | 简单扩展，适合小型集群                  |
| Amazon S3          | 对象存储          | 云原生，海量存储，提供 SLA 和可扩展性   |
| Cassandra/DynamoDB | 分布式数据库/对象 | AP 取向，最终一致性，高可用             |



## **六、CAP**

在理论计算机科学中，CAP定理（CAP theorem），又被称作布鲁尔定理（Brewer's theorem），它指出对于一个分布式计算系统来说，不可能同时满足以下三点: 

- 一致性（Consistency） （等同于所有节点访问同一份最新的数据副本）
- 可用性（Availability）（每次请求都能获取到非错的响应——但是不保证获取的数据为最新数据）
- 分区容错性（Partition tolerance）（以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在C和A之间做出选择。）

根据定理，分布式系统只能满足三项中的两项而不可能满足全部三项。理解CAP理论的最简单方式是想象两个节点分处分区两侧。允许至少一个节点更新状态会导致数据不一致，即丧失了C性质。如果为了保证数据一致性，将分区一侧的节点设置为不可用，那么又丧失了A性质。除非两个节点可以互相通信，才能既保证C又保证A，这又会导致丧失P性质。

